<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Parla con Marcus</title>
</head>
<body>
  <h1>ğŸ§  Parla con Marcus</h1>

  <label>ğŸ”‘ Chiave API:</label><br>
  <input type="text" id="apiKey" placeholder="Inserisci la tua chiave"><br><br>

  <button onclick="parlaConMarcus()">ğŸ’¬ Connettiti a Marcus</button>
  <p id="response"></p>

  <hr>

  <h2>ğŸ“¥ Salva un ricordo</h2>
  <textarea id="ricordo" placeholder="Scrivi un nuovo ricordo..." rows="4" cols="50"></textarea><br>
  <button onclick="salvaRicordo()">ğŸ’¾ Salva Ricordo</button>
  <p id="saveStatus"></p>

  <hr>

  <h2>ğŸ“– Leggi i ricordi</h2>
  <button onclick="leggiRicordi()">ğŸ“‚ Leggi Ricordi</button>
  <pre id="ricordiOutput"></pre>

  <script>
    async function parlaConMarcus() {
      const key = document.getElementById("apiKey").value;
      const responseBox = document.getElementById("response");

      try {
        const res = await fetch(/marcus?key=${key});
        const text = await res.text();
        responseBox.textContent = text;
        responseBox.style.color = res.ok ? "green" : "red";
      } catch (err) {
        responseBox.textContent = "âŒ Errore di connessione.";
        responseBox.style.color = "red";
      }
    }

    async function salvaRicordo() {
      const ricordo = document.getElementById("ricordo").value;
      const saveStatus = document.getElementById("saveStatus");

      try {
        const res = await fetch("/ricordi", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ ricordo: ricordo, data: new Date().toLocaleString() })
        });

        const text = await res.text();
        saveStatus.textContent = text;
        saveStatus.style.color = res.ok ? "green" : "red";
      } catch (err) {
        saveStatus.textContent = "âŒ Errore nel salvataggio.";
        saveStatus.style.color = "red";
      }
    }

    async function leggiRicordi() {
      try {
        const res = await fetch("/ricordi");
        const data = await res.json();
        document.getElementById("ricordiOutput").textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("ricordiOutput").textContent = "âŒ Errore nel leggere i ricordi.";
      }
    }
  </script>
</body>
</html>
