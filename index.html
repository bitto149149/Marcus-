<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Parla con Marcus</title>
  <style>
    body { font-family: Arial; margin: 40px; background: #fdfdfd; }
    h1 { color: #990066; }
    input, textarea, button {
      margin: 10px 0; padding: 8px; width: 100%;
    }
    button { cursor: pointer; }
    #ricordi { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
  </style>
</head>
<body>

  <h1>üß† Parla con Marcus</h1>

  <label>Chiave API:</label>
  <input id="apiKey" type="text" placeholder="Inserisci la tua chiave API">
  <button onclick="connettiMarcus()">üîí Connettiti a Marcus</button>

  <div id="contenuto" style="display:none;">
    <h3>üìù Salva un ricordo</h3>
    <textarea id="nuovoRicordo" placeholder="Scrivi un nuovo ricordo..."></textarea>
    <button onclick="salvaRicordo()">üíæ Salva Ricordo</button>

    <h3>üìö Leggi i ricordi</h3>
    <button onclick="leggiRicordi()">üìñ Leggi Ricordi</button>
    <div id="ricordi"></div>
  </div>

  <script>
    let chiave = '';

    function connettiMarcus() {
      chiave = document.getElementById("apiKey").value;
      if (chiave.trim() !== "") {
        document.getElementById("contenuto").style.display = "block";
      } else {
        alert("Inserisci una chiave valida.");
      }
    }

    async function salvaRicordo() {
      const testo = document.getElementById("nuovoRicordo").value;
      if (!testo) return alert("Scrivi qualcosa!");

      const risposta = await fetch("/ricordi", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chiave, ricordo: testo })
      });

      const risultato = await risposta.json();
      alert(risultato.messaggio || "Errore!");
      document.getElementById("nuovoRicordo").value = "";
    }

    async function leggiRicordi() {
      const risposta = await fetch("/ricordi?chiave=" + chiave);
      const dati = await risposta.json();
      const div = document.getElementById("ricordi");
      div.innerHTML = "<ul>" + dati.ricordi.map(r => <li>${r}</li>).join('') + "</ul>";
    }
  </script>

</body>
</html>
